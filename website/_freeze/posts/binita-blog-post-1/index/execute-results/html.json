{
  "hash": "76b1f51d2fb867d7e364eeca0eb2401e",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Adding Binning\"\ndescription: \"Adding Binning to dataset to decrease Granularity\"\nauthor:\n  - name: Binita Subedi\n    url: https://github.com/Binita-subedi\n    affiliation: Master of Cyber Security Program @ The University of West Florida (UWF)\n    # affiliation-url: https://ucsb-meds.github.io/\n# date: 10-24-2022\ncategories: [binita]\n# citation:\n#   url: https://samanthacsik.github.io/posts/2022-10-24-my-blog-post/\nimage: images/binita.jpg\ndraft: false\nbibliography: references.bib\nlink-citations: true\n---\n\nOn this exploratory phase I will be adding binning to handle with the granularity and hierarchy of the dataset.\n\n\n## Introduction\n\nThis Project is explained on Quarto/R Markdown code. \n\nThe loaded dataset finds the root on Git repository and constructs the path to the datasets folder and the CSV file. \n\nIt then loads the CSV into a data frame called all_states_data. A data frame all_states_data\n\nThe project contains a data frame all_states_data with 13,212 rows and 82 columns.\n\nTime series analysis packages (including tsibble, feasts, fable): fpp3\n\nData manipulation and cleaning: dplyr, tidyr\n\nPlotting: ggplot2\n\nExtends ggplot2 for time series plots: ggtime\n\nCombine multiple ggplots: patchwork\n\n## 1. Load packages\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# install.packages(\"fpp3\")\nlibrary(fpp3)\nlibrary(dplyr)\nlibrary(tidyr)\nlibrary(ggplot2)\nlibrary(ggtime)\nlibrary(patchwork)\n```\n:::\n\n\n## 2. Load the Dataset\n\nThe following code will locate the folder **datasets** and then it will give back the variable **datasets_path** which you can use to build the path to the desired data to be loaded.\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\nfind_git_root <- function(start = getwd()) {\n  path <- normalizePath(start, winslash = \"/\", mustWork = TRUE)\n  while (path != dirname(path)) {\n    if (dir.exists(file.path(path, \".git\"))) return(path)\n    path <- dirname(path)\n  }\n  stop(\"No .git directory found — are you inside a Git repository?\")\n}\n\nrepo_root <- find_git_root()\ndatasets_path <- file.path(repo_root, \"datasets\")\nzillow_economics_data_path <- file.path(datasets_path, \"zillow-economics-data-01\")\n\nstate_time_series <- file.path(zillow_economics_data_path, \"State_time_series.csv\")\nall_states_data <- read.csv(state_time_series)\n```\n:::\n\n\n## 3. Exploring Data\n\nLet's convert Data column to Data type\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# convert data column to Data type\nall_states_data <- all_states_data %>%\nmutate(Date = as.Date(Date, format = \"%Y-%m-%d\"))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check the structure\nstr(all_states_data)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n'data.frame':\t13212 obs. of  82 variables:\n $ Date                                                         : Date, format: \"1996-04-30\" \"1996-04-30\" ...\n $ RegionName                                                   : chr  \"Alabama\" \"Arizona\" \"Arkansas\" \"California\" ...\n $ DaysOnZillow_AllHomes                                        : num  NA NA NA NA NA NA NA NA NA NA ...\n $ InventorySeasonallyAdjusted_AllHomes                         : int  NA NA NA NA NA NA NA NA NA NA ...\n $ InventoryRaw_AllHomes                                        : int  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_1Bedroom                           : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_2Bedroom                           : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_3Bedroom                           : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_4Bedroom                           : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_5BedroomOrMore                     : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_AllHomes                           : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_CondoCoop                          : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_DuplexTriplex                      : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPricePerSqft_SingleFamilyResidence              : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_1Bedroom                                  : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_2Bedroom                                  : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_3Bedroom                                  : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_4Bedroom                                  : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_5BedroomOrMore                            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_AllHomes                                  : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_CondoCoop                                 : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_DuplexTriplex                             : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianListingPrice_SingleFamilyResidence                     : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianPctOfPriceReduction_AllHomes                           : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianPctOfPriceReduction_CondoCoop                          : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianPctOfPriceReduction_SingleFamilyResidence              : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianPriceCutDollar_AllHomes                                : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianPriceCutDollar_CondoCoop                               : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianPriceCutDollar_SingleFamilyResidence                   : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_1Bedroom                            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_2Bedroom                            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_3Bedroom                            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_4Bedroom                            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_5BedroomOrMore                      : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_AllHomes                            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_CondoCoop                           : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_DuplexTriplex                       : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_MultiFamilyResidence5PlusUnits      : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_SingleFamilyResidence               : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPricePerSqft_Studio                              : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_1Bedroom                                   : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_2Bedroom                                   : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_3Bedroom                                   : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_4Bedroom                                   : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_5BedroomOrMore                             : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_AllHomes                                   : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_CondoCoop                                  : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_DuplexTriplex                              : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_MultiFamilyResidence5PlusUnits             : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_SingleFamilyResidence                      : num  NA NA NA NA NA NA NA NA NA NA ...\n $ MedianRentalPrice_Studio                                     : num  NA NA NA NA NA NA NA NA NA NA ...\n $ ZHVIPerSqft_AllHomes                                         : int  50 62 42 102 82 85 71 56 55 185 ...\n $ PctOfHomesDecreasingInValues_AllHomes                        : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfHomesIncreasingInValues_AllHomes                        : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfHomesSellingForGain_AllHomes                            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfHomesSellingForLoss_AllHomes                            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfListingsWithPriceReductionsSeasAdj_AllHomes             : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfListingsWithPriceReductionsSeasAdj_CondoCoop            : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfListingsWithPriceReductionsSeasAdj_SingleFamilyResidence: num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfListingsWithPriceReductions_AllHomes                    : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfListingsWithPriceReductions_CondoCoop                   : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PctOfListingsWithPriceReductions_SingleFamilyResidence       : num  NA NA NA NA NA NA NA NA NA NA ...\n $ PriceToRentRatio_AllHomes                                    : num  NA NA NA NA NA NA NA NA NA NA ...\n $ Sale_Counts                                                  : num  NA NA NA NA NA NA NA NA NA NA ...\n $ Sale_Counts_Seas_Adj                                         : num  NA NA NA NA NA NA NA NA NA NA ...\n $ Sale_Prices                                                  : num  NA NA NA NA NA NA NA NA NA NA ...\n $ ZHVI_1bedroom                                                : int  61500 59200 53000 93700 77800 64700 90100 45400 74900 152300 ...\n $ ZHVI_2bedroom                                                : int  48900 86400 54500 123400 97500 97000 88200 65400 64700 186600 ...\n $ ZHVI_3bedroom                                                : int  78200 96100 76800 150900 129000 130400 103500 89100 88000 231800 ...\n $ ZHVI_4bedroom                                                : int  146500 128400 135100 196100 176100 194800 157800 133600 149700 303400 ...\n $ ZHVI_5BedroomOrMore                                          : int  206300 190500 186000 265300 212900 299800 176100 199900 212800 345500 ...\n $ ZHVI_AllHomes                                                : int  79500 103600 64400 157900 128100 132000 106800 86300 92000 227400 ...\n $ ZHVI_BottomTier                                              : int  45600 67100 38400 95100 82700 83700 77200 52500 57200 144500 ...\n $ ZHVI_CondoCoop                                               : int  99500 78900 70300 136100 99400 85000 NA 70600 89300 177000 ...\n $ ZHVI_MiddleTier                                              : int  79500 103600 64400 157900 128100 132000 106800 86300 92000 227400 ...\n $ ZHVI_SingleFamilyResidence                                   : int  79000 107500 64500 162000 133600 141000 107400 92100 92400 262600 ...\n $ ZHVI_TopTier                                                 : int  140200 168700 115200 270600 209300 231600 161600 155300 163900 374700 ...\n $ ZRI_AllHomes                                                 : int  NA NA NA NA NA NA NA NA NA NA ...\n $ ZRI_AllHomesPlusMultifamily                                  : int  NA NA NA NA NA NA NA NA NA NA ...\n $ ZriPerSqft_AllHomes                                          : num  NA NA NA NA NA NA NA NA NA NA ...\n $ Zri_MultiFamilyResidenceRental                               : int  NA NA NA NA NA NA NA NA NA NA ...\n $ Zri_SingleFamilyResidenceRental                              : int  NA NA NA NA NA NA NA NA NA NA ...\n```\n\n\n:::\n:::\n\n\nWe convert the Date column to proper Date type so it can be used in time series analysis. \n\n**str() shows structure:** column names, types, and example data.\n\n**Output:**\n\n- Data column is Data type.\n- Other column include RegionName, ZHVI_AllHomes, and many Zillow metrics.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Convert to tsibble for time series analysis\n# Assuming 'State' is a column and 'Value' is the metric\n\nlibrary(tsibble)\n\nstate_tsibble <- all_states_data %>%\nas_tsibble(key = RegionName, index = Date)\n```\n:::\n\n\nWe convert the data frame into a tsibble (time series tibble)\n\n- key = RegionName: each state is treated as a seperate time series\n- index = Date:the date column is the time index.\n\n**Output:**\n\n**state_tsibble** is now a tsibble with 13,212 rows and 82 columns, ready for time series operations.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Inspect first rows\nstate_tsibble %>% head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 6 x 82 [1D]\n# Key:       RegionName [1]\n  Date       RegionName DaysOnZillow_AllHomes InventorySeasonallyAdjusted_AllH…¹\n  <date>     <chr>                      <dbl>                              <int>\n1 1996-04-30 Alabama                       NA                                 NA\n2 1996-05-31 Alabama                       NA                                 NA\n3 1996-06-30 Alabama                       NA                                 NA\n4 1996-07-31 Alabama                       NA                                 NA\n5 1996-08-31 Alabama                       NA                                 NA\n6 1996-09-30 Alabama                       NA                                 NA\n# ℹ abbreviated name: ¹​InventorySeasonallyAdjusted_AllHomes\n# ℹ 78 more variables: InventoryRaw_AllHomes <int>,\n#   MedianListingPricePerSqft_1Bedroom <dbl>,\n#   MedianListingPricePerSqft_2Bedroom <dbl>,\n#   MedianListingPricePerSqft_3Bedroom <dbl>,\n#   MedianListingPricePerSqft_4Bedroom <dbl>,\n#   MedianListingPricePerSqft_5BedroomOrMore <dbl>, …\n```\n\n\n:::\n:::\n\n\n## 4. Binning Time series Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Monthly aggregation (mean per month)\nlibrary(dplyr)\nlibrary(ggtime)\nlibrary(tsibble)\n\nmonthly_binned <- state_tsibble %>%\nindex_by(Month = yearmonth(Date)) %>%\nsummarise(Avg_ZHVI_AllHomes = mean(ZHVI_AllHomes, na.rm = TRUE))\n\nmonthly_binned %>% head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 6 x 2 [1M]\n     Month Avg_ZHVI_AllHomes\n     <mth>             <dbl>\n1 1996 Apr           101744.\n2 1996 May           101440 \n3 1996 Jun           101555 \n4 1996 Jul           101678.\n5 1996 Aug           101815 \n6 1996 Sep           101998.\n```\n\n\n:::\n:::\n\n\nindex_by(Month = yearmonth(Date)): groups the data by month.\n\nsummarise(Avg_ZHVI_AllHomes = mean(...)): calculates the average zillow home Value Index (ZHVI) per month.\n\nna.rm = TRUE: ignores missing values.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Quarterly aggregation example\nquarterly_binned <- state_tsibble %>%\n  index_by(Quarter = yearquarter(Date)) %>%\n  summarise(Avg_ZHVI_AllHomes = mean(ZHVI_AllHomes, na.rm = TRUE))\n\nquarterly_binned %>% head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tsibble: 6 x 2 [1Q]\n  Quarter Avg_ZHVI_AllHomes\n    <qtr>             <dbl>\n1 1996 Q2           101578.\n2 1996 Q3           101830 \n3 1996 Q4           102449.\n4 1997 Q1           103248.\n5 1997 Q2           104115.\n6 1997 Q3           105008 \n```\n\n\n:::\n:::\n\n\nThe output is same as monthly aggregation, but grouped by quarter instead of month. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot binned data\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(tsibble)\nlibrary(ggtime)\n\n# Convert Month to a regular Date (first day of the month)\nmonthly_binned_df <- monthly_binned %>%\n  as_tibble() %>%                    # convert to tibble\n  mutate(Month = as.Date(Month))     # convert yearmonth to Date\n```\n:::\n\n\nWe convert the monthly_binned tsibble into a regular tibble.\n\nAlso, convert Month from yearmonth to a standard Date for ggplot.\n\nThe output monthly_binned_df has two columns: Month (Date) and Avg_ZHVI_AllHomes\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot with ggplot\nggplot(monthly_binned_df, aes(x = Month, y = Avg_ZHVI_AllHomes)) +\n  geom_line(color = \"blue\") +\n  labs(title = \"Monthly Binned Average of ZHVI_AllHomes\",\n       x = \"Month\", y = \"Average ZHVI_AllHomes\") +\n  theme_minimal() +\n  theme(axis.text.x = element_text(angle = 45, hjust = 1))\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n\n\nWe plot a line chart of monthly average home values\n\n- x = Month, \n- Y = Avg_ZHVI_AllHomes\n\ngeom_line(color = \"blue\"): draws the line in blue.\n\nalso, rotates x-axis labels for readability.\n\nA line graph shows trends in average home prices per month over time.\n\nPeaks and troughs indicate periods of rising/falling home prices.\n\n### References\n\n::: {#refs}\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}